# 采购系统接口文档
<font color=red> 0823修改 </font>

## 账户相关
### 人员权限
**管理员：**

用户名:admin

密码:admin8888

权限：增加、删除账户，重置账户密码

**粮食公司：**

用户`role`属性表示为`0`

权限:
- 物品的查看、添加、删除、修改
-  价格的修改 、查询
- 计量单位的添加、查询、修改
- 商品种类的添加、查询、修改

**教体局：**

用户`role`属性表示为`1`

权限：
- 物品的查看
-  价格周期创建 
-  价格请求审核 

**学校：**

用户`role`属性表示为`2`

权限：
- 物品的查看

### 相关API
`account`账号数据表:  
<font color=red> 增加first_name字段表示名称 </font>   

```javascript
{
    id              # 账号ID
    username        # 用户名（登录使用）
    password        # 账号密码（登录使用）
    role            # 权限组
    first_name      # 名称
}
```
#### 1. 添加人员（仅限管理员）
用于添加访问账户，可选用户所属角色组，关系到访问权限。新添加的用户的密码都是`123456`，并在登录时以`is_simple`标记用户是否修改了默认密码。  
<font color=red> 增加first_name字段 </font>  

```javascript
{
    url : http://127.0.0.1:7999/api/accounts/
    method : POST
    data : {
        "username"   # 用户名
        "role"       # 角色(粮油公司0, 教体局1, 学校2)
        "first_name" # 表示名称
    }
    return : {
        "msg":     # 消息
        "data":    # 数据
        "code":    # 状态码
    }
}
```
示例：
```javascript
{
    url : http://127.0.0.1:7999/api/accounts/
    method : POST
    data : {
        "username" : "ldzx",
        "role" : 2,
        "first_name" : "泸定中学"
    }
    return : {
        "msg": "创建成功",
        "data": {
            "id": 8,
            "username": "ldzx",
            "first_name" : "泸定中学",
            "is_active": true,
            "role": 2
        },
        "code": 201
    }   
}
```
#### 2. 修改密码（用户）
用于用户修改自己的密码，仅能修改自己的密码
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/<id>/
    method : PUT
    data: {
        "username" # id对应的用户名
        "password" # 修改后的密码
    }
    return : {
        "msg"
        "data":{
            "id"
            "username"
            "is_active"
            "first_name"
            "role"
        }
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/4/
    method : PUT
    data : {
        "username":"ldzx",
        "password":"654321"
    }
    return : {
        "msg":"更新成功",
        "data":{
            "id": 4,
            "username": "ldzx",
            "first_name" : "泸定中学",
            "is_active": true,
            "role": 2
        },
        "code":200
    }  
}
```
#### 3. 重置密码（管理员）
用于用户遗忘密码无法登录时，管理员进行强制密码重置，用户密码将会重置为`123456`。
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/<id>/
    method : PATCH
    data : {
        "username" # id对应的用户名
    }
    return : {
        "msg"
        "data":{
            "id"
            "username"
            "is_active"
            "role"
        }
        "code"
    }
}
```
示例：
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/4/
    method : PATCH
    data : {
        "username":"ldzx",
    }
    return : {
        "msg":"更新成功",
        "data":{
            "id": 4,
            "username": "ldzx",
            "is_active": true,
            "role": 2
        },
        "code":200
    }   
}
```
#### 4. 查询账户
<font color=red> 返回响应增加first_name字段 </font>   

所有用户均可以进行查询，能查询到用户名和组别。可用组别`role`来进行筛选。
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/
    method : GET
    params : {
        "role"      # 组别
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"            # 用户ID
                    "username"      # 用户名
                    "role"          # 用户组别
                    "first_name"    # 名称
                },
            ]
        },
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/accounts/
    method : GET
    params : {
        "role"      # 组别
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 1,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 2,
                    "username": "jtj",
                    "role": 1,
                    "first_name": "教体局"
                }
            ]
        },
        "code": 200
    }
}

```
#### 5. 用户登录
用于用户登录获得`token`，系统会返回`token`、`username`、`role`等，可用于前端分权限显示界面。绝大部分后端API都需要传入`token`。  
<font color=red> 返回响应增加first_name字段 </font>   

```javascript
{
    url : http://127.0.0.1:7999/api/login/
    method : POST
    data : {
        "username" # 用户名
        "password" # 密码
    }
    return : {
        "msg"
        "data":{
            "refresh"       # 用于刷新token，暂时没用
            "access"        # token，用于权限管理
            "id"            # 用户ID,有很多地方需要传入id
            "username"      # 用户名
            "first_name"    # 名称
            "role"          # 角色组，进行分组权限管理
            "is_simple"     # 标记密码是否为默认密码，如果为true，应指引用户进行修改
            "is_admin"      # 标记是否为管理员
        },
        "code"
    }
}
```
示例:
```javascript
{
    url : http://127.0.0.1:7999/api/login/
    method : POST
    data : {
        "username" : "ldzx",
        "password" : "123456"
    }
    return : {
        "msg":"Login successfully",
        "data":{
            "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTcxNjU0NDY1MSwiaWF0IjoxNzE1OTM5ODUxLCJqdGkiOiI0N2RmZmM4MzQzM2Y0NTkxYjc4MjNlZGU4NTBjNmY5MCIsInVzZXJfaWQiOjR9.xbggOkQF4XXHPLNrLmS93er0ClN3m7jtzHhywFM1w_s",
            "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzE2NTQ0NjUxLCJpYXQiOjE3MTU5Mzk4NTEsImp0aSI6ImZiNDBiM2EwMmUzNzRhOTRiOWM2OWQxMjRlOGY5ODE0IiwidXNlcl9pZCI6NH0.tOo1DuT-HD9nHLr9xyQHzPg8cO94Z9lkiZD6NRuUpvU",
            "id": 4,
            "username": "ldzx",
            "first_name": "泸定中学",
            "role": "2",
            "is_simple": true,
            "is_admin": false
        }
        "code":200
    }
}
```
## 商品相关
### 商品API
`goods`商品数据表：  
<font color=red> 增加brand字段，表示品牌 </font>   

```javascript
{
    id              # 商品ID
    name            # 商品名
    category        # 外键字段，商品种类实例，数据库中为category_id,种类id
    brand           # 商品品牌
    image           # 商品图片
    license         # 商品凭证
    description     # 商品描述，文本类型
    status          # 商品状态
    create_at       # 商品创建时间，自动添加
    update_at       # 商品更新时间，自动添加
}
```
#### 1. 查看所有商品
**权限：所有登录的用户**

非粮油公司(`role=0`)用户查询时，只能查询到已上架并且在当前价格周期内存在已审核价格的商品  
粮油公司查询时可以查询到所有创建的商品，包括未上架和价格未审核的商品，这些商品的价格`price`会被设置为`null`   
- 可以使用`category_id`筛选商品类别 
- <font color=red> 可以使用`product_name`对商品名进行模糊筛选；返回新增了`brand`和`license` </font>   
```javascript
{
    url : http://127.0.0.1:8000/api/goods/
    method : GET
    params : {
        page                        # 页数
        page_size                   # 每页的个数
        category_id                 # 商品类别id
        product_name                # 商品名
    }
    return : {
        "msg",
        "data":{
            "count"                  # 查询到的总个数
            "next"                   # 下一页
            "previous"               # 上一页
            "results": [
                {
                    "id"             # 商品ID
                    "name"           # 商品名称
                    "brand"          # 商品品牌
                    "image"          # 商品图片
                    "category"       # 商品类别
                    "license"        # 商品凭证
                    "description"    # 商品规格
                    "price"          # 商品价格
                }
            ]
        },
        "code"
    }
}
```

 示例
```javascript
 {
    url : http://127.0.0.1:8000/api/goods/
    method : GET
    params : {
        page        # 页数
        page_size   # 每页的个数
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 4,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 7,
                    "name": "精后腿肉",
                    "image": null,
                    "description": "称重（斤）",
                    "category": "肉类",
                    "brand": "正大",
                    "license": null,
                    "price": 12.83
                },
                {
                    "id": 8,
                    "name": "精五花肉",
                    "image": null,
                    "description": "称重（斤）",
                    "category": "肉类",
                    "brand": "正大",
                    "license": null,
                    "price": 12.83
                }
            ]
        },
        "code": 200
    }
}
 ```

#### 2. 添加商品
**权限：仅粮油公司组(`role=0`)**  
添加商品，添加时会传入一个价格，系统会用该价格创建当前周期以及结束日期在现在时间点之后的周期所使用的价格对象，并将价格对象的`status`设置为`1`（未审核）,自动生成价格请求.必须先有价格周期，才能创建商品  
<font color=red> 增加品牌和凭证字段 </font>

```javascript
{
    url : http://127.0.0.1:8000/api/goods/
    method : POST
    data : {
        "name"              # 商品名称
        "image"             # 商品图片（非必须）
        "license"           # 商品凭证（非必须）
        "brand"             # 商品品牌
        "description"       # 商品描述（规格）
        "price"             # 商品价格
        "price_check_1"     # 询价1
        "price_check_2"     # 询价2
        "price_check_avg"   # 平均询价
        "category"          # 商品类别（注意需要先在数据库中添加商品类别，然后传入对应单位的id）
    }
    return : {
        "msg",
        "data":{
            "id"
            "name"
            "image"
            "license"
            "brand"         
            "description"
            "category"
            "price"
        }，
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/goods/
    method : POST
    data : {
        "name": "土豆2"
        "image": 图片文件
        "description": "这是土豆2"
        "category": 2
        "price": 9.68
    }
    return : {
        "msg": "创建成功",
        "data": {
            "id": 16,
            "name": "味精",
            "image": null,
            "description": "瓶",
            "category": "干杂类",
            "brand": "统一",
            "license": null,
            "price": null
        },
        "code": 201
    }
}
```

#### 3. 删除商品
**权限：仅粮油公司组(`role=0`)**
```javascript
{
    url : http://127.0.0.1:8000/api/goods/<id>/
    method : DELETE
    return : {
        "msg",
        "data":null,
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/goods/13/
    method : DELETE
    return : {
        "msg":"删除成功",
        "data":null,
        "code":204
    }
}
```
#### 4. 修改商品
**权限：仅粮油公司组(`role=0`)**

<font color=red> 修改商品时可以修改品牌和凭证字段，返回响应字段添加 </font>  
修改商品的属性，与价格相关的属性不能修改`price`。

```javascript
{
    url : http://127.0.0.1:8000/api/goods/<id>/
    method : PATCH
    data : {
        "name"          # 商品名称
        "image"         # 商品图片
        "description"   # 商品规格
        "category"      # 商品类别
        "brand"         # 商品品牌

    }
    return : {
        "msg",
        "data":{
            "id"
            "name"
            "image"         
            "description"
            "price"
            "category"
            "brand"
            "license"
        }，
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/goods/13/
    method : PATCH
    data : {
        "image"
        "description":"这是土豆3"
        "category": 2
    }
    return : {
        "msg": "更新成功",
        "data": {
            "id": 13,
            "name": "土豆2",
            "image": "http://127.0.0.1:8000/media/goods/yangyu.jpg",
            "description": "这是土豆3",
            "brand": "统一",
            "license": null,
            "category": "蔬菜类",
            "price": 9.68,
        },
        "code": 200
    }
}
```
### 商品类别API
`category`商品类别数据表：
```javascript
{
    id          # 商品类别id
    name        # 商品类别名
}
```
#### 1. 查看商品类别
**权限：所有登录用户**
```javascript
{
    url : http://127.0.0.1:8000/api/category/
    method : GET
    return : {
        "msg",
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"
                    "name"
                }
            ]
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/category/
    method : GET
    return : {
        "msg": "ok",
        "data": {
            "count": 3,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 1,
                    "name": "肉类"
                },
                {
                    "id": 2,
                    "name": "蔬菜类"
                },
                {
                    "id": 3,
                    "name": "水果类"
                }
            ]
        },
        "code": 200
    }
}
```
#### 2. 添加商品类别
**权限：仅粮油公司组(`role=0`)**
```javascript
{
    url : http://127.0.0.1:8000/api/category/
    method : POST
    data : {
        "name"          # 类别名
    }
    return : {
        "msg",
        "data": {
            "id"
            "name"
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/category/
    method : POST
    data : {
        "name":"厨具"         
    }
    return : {
        "msg": "创建成功",
        "data": {
            "id": 5,
            "name": "厨具"
        },
        "code": 201
    }
}
```
#### 3. 删除商品类别
**权限：仅粮油公司组(`role=0`)**
```javascript
{
    url : http://127.0.0.1:8000/api/category/<id>/      # id为类别id
    method : DELETE
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/category/5/
    method : DELETE
    return : {
        "msg": "删除成功",
        "data": null,
        "code": 204
    }
}
```
## 价格相关
### 商品价格API
`price`商品价格数据表：
```javascript
{
    id              # 价格ID
    product         # 外键字段，价格对应的商品实例，数据库中为product_id，商品id
    price           # 最终价格（平均询价下调5%）
    pric_check_1    # 询价1
    pric_check_2    # 询价2
    pric_check_avg  # 平均询价
    cycle           # 外键字段，价格对应的价格周期实例，数据库中为cycle_id,周期id
    start_date      # 价格开始时间
    end_date        # 价格结束时间
    status          # 价格状态，共五种
    creater_id      # 报价人ID
    create_time     # 报价申报时间
    reviewer_id     # 审核人ID
    reviewer_time   # 报价审核时间
}
```

现在修改为不由粮油公司组(`role=0`)创建价格，而是教体局组(`role=1`)创建价格周期。当价格周期被创建时，会自动为所有商品创建当前价格周期对应的一个价格对象`price`。`price`的初始状态`status`为`0`，表示为未申报。状态总共有4种，`0：未申报,1：未审核，2：已审核，-1：已拒绝,-99：已弃用`。一个`price`对象对应一个`product`商品和一个`cycle`价格周期。

#### 1. 查看所有价格
**权限：仅粮油公司组(`role=0`)**  

查看目前已有的价格对象，可使用`product_id`、`status`、`cycle_id`进行筛选。  
可以用商品种类id和商品名作为筛选，使用`category_id`和`product_name`。返回字段中添加了周期名字`cycle_name`
修改了状态的表示，现在`status`是中文表示状态名，`status_code`为状态的编码表示，用于筛选字段。   
修改了返回字段，添加了询价   

```javascript
{
    url : http://127.0.0.1:8000/api/price/
    method : GET
    params: {
        page
        page_size
        product_id      # 商品ID，筛选出某个商品的所有价格对象
        product_name    # 商品名，筛选出某个商品的所有价格对象
        status          # 商品状态，筛选出某个状态下的所有价格对象
        cycle_id        # 周期ID，筛选出某个周期下的所有价格对象
        category_id     # 种类ID，筛选出某个种类下的所有价格对象
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"                    # 价格对象的ID,修改报价时需使用
                    "price"                 # 当前价格（平均询价下调5%）
                    "price_check_1"         # 询价1
                    "price_check_2"         # 询价2
                    "price_check_avg"       # 平均询价
                    "start_date"            # 价格开始日期
                    "end_date"              # 价格结束日期
                    "status"                # 价格状态
                    "status_code"           # 价格状态编码
                    "creater_id"            # 价格创建者ID
                    "create_time"           # 价格创建时间
                    "reviewer_id"           # 审核人ID
                    "review_time"           # 审核时间
                    "product_id"            # 商品ID
                    "cycle_id"              # 价格周期ID
                    "cycle_name"            # 价格周期名
                    "product_name"          # 商品名称
                    "product_category"      # 商品规格
                    "product_description"   # 商品描述
                }
            ]
        },
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price?product_id=4
    method : GET
    return : {
        "msg": "ok",
        "data": {
            "count": 16,
            "next": "http://127.0.0.1:8000/api/price/?page=2&&status=2",
            "previous": null,
            "results": [
                {
                    "id": 37,
                    "price": "28.28",
                    "price_check_1": "28.00",
                    "price_check_2": "30.00",
                    "price_check_avg": "29.00",
                    "start_date": "2024-06-01",
                    "end_date": "2024-07-01",
                    "creater_id": 3,
                    "create_time": "2024-06-17T14:39:51.271438",
                    "reviewer_id": 2,
                    "review_time": "2024-06-17T14:40:32.101858",
                    "product_id": 2,
                    "cycle_id": 10,
                    "cycle_name": "202406",
                    "status_code": "2",
                    "status": "已审核",
                    "product_name": "土豆",
                    "product_category": "蔬菜类",
                    "product_description": "这是土豆"
                }
            ]
        },
        "code": 200
    }
}
```

#### 2. 修改商品价格
**权限：仅粮油公司组(`role=0`)**  

使用`PATCH`方法修改报价，会将`price`对象的`status`修改为`1`未审核，`creater_id`为当前操作人的`id`，`reviewer_id`和`review_time`将被设置为`null`，并同步提交一个价格请求给教体局方。`status`为`0`的价格（由上一个周期复制而来或者新建的商品）也以此方法提交报价，可以选择不修改价格（请求体不传入数据）。     
修改了返回字段，添加了询价   

```javascript
{
    url : http://127.0.0.1:8000/api/price/<id>/     # 传入的为价格对象的id
    method : PATCH
    data : {
        price           # 价格（平均询价下调5%）
        price_check_1   # 询价1
        price_check_2   # 询价1
        price_check_avg # 平均询价
    }
    return : {
        // 返回的参数和GET方法一致
        "msg"
        "data": {
            "price"
            "price_check_1"
            "price_check_2"
            "price_check_avg"
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/9/     # 传入的为价格对象的id
    method : PATCH
    data : {
        "price" : 52.52           # 修改后的价格
    }
    return : {
        "msg": "更新成功",
        "data": {
            "price": "52.52",
            "price_check_1": "18.00",
            "price_check_2": "33.00",
            "price_check_avg": "27.00"
        },
        "code": 200
    }
}
```
#### 3. 上传清单
上传清单功能,要保证使用的excel文件的结构不发生改变.工作簿名作为类别名,当不存在该类时会创建.当数据库中不存在某种规格的某个商品时,会创建该商品,和手动创建商品一样会同时创建价格请求.上传文件的方式修改报价只能修改`status=0`的报价,即教体局创建价格周期后自动生成的价格对象.`status`处于未审核和已审核和已拒绝的报价不能通过这种方式修改报价,会返回错误信息.    
需要传入周期ID`cycle`，仅针对某一个周期进行报价修改   
**使用方法:每次教体局创建价格周期后,上传报价表,然后针对未通过或其他状态的价格使用其他api进行逐一修改.**

```javascript
{
    url : http://127.0.0.1:8000/api/goods/upload/     
    method : POST
    data : {
        file           # excel文件
        cycle          # 价格周期的ID
    }
    return : {
        // 返回的参数和GET方法一致
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/goods/upload/ 
    method : POST
    data : {
        "file" : xxx.xlsx
        "cycle" : 5
    }
    return : {
        "msg": "商品添加成功/报价修改成功",
        "data": null,
        "code": 200
    }
}
```
当部分报价修改失败或商品添加失败时,会返回失败信息
示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/upload/ 
    method : POST
    data : {
        "file" : xxx.xlsx
    }
    return : {
        "msg": "部分商品添加失败或报价修改失败",
        "data": {
            "报价修改失败":[{
                "name": "建华香油",
                "description": "450ml",
                "price_check_1": 15.9,
                "price_check_2": 15.9,
                "price_check_avg": 15.9,
                "price": 15.11,
                "category": 6
            },],
            "商品添加失败":[],
        },
        "code": 200
    }
}
```



### 价格周期API
`price_cycle`价格周期数据表：
```javascript
{
    id          # 价格周期ID
    name        # 价格周期名
    start_date  # 周期开始时间
    end_date    # 周期结束时间
    status      # 周期状态（0表示弃用）
    creater_id  # 周期创建人ID
    create_at   # 周期创建时间，自动添加
    update_at   # 周期修改时间，自动添加
}
```

#### 1. 添加一个价格周期
**权限：仅教体局组(`role=1`)**  
教体局账户添加一个价格周期后，会为每个商品创建一个当期的价格对象`price`。  
 返回响应删除了`status`。 

```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/
    method : POST
    data : {
        "name"                # 价格周期名字
        "start_date "         # 开始日期（格式为 "年-月-日"）
        "end_date "           # 结束日期（格式为 "年-月-日"）
    }
    return : {
        "msg"
        "data": {
            "id"                # 价格周期ID
            "name"              # 价格周期名字
            "start_date"        # 开始日期
            "end_date"          # 结束日期
            "creater_id"        # 创建人ID
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/
    method : POST
    data : {
        "name" : "202407"
        "start_date" : "2024-07-01"          
        "end_date" : "2024-08-01"  
    }
    return : {
        "msg": "创建成功",
        "data": {
            "id": 7,
            "name": "202407",
            "start_date": "2024-07-01",
            "end_date": "2024-08-01",
            "creater_id": 9
        },
        "code": 201
    }
}
```

#### 2. 查看所有的价格周期
 **权限：教体局组(`role=1`)和粮油公司组(`role=0`)**  
查看所有已创建的价格周期，可用于粮油公司查找价格时，进行日期筛选。只能查看到`status`为`true`的周期。
```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/
    method : GET
    params : {
        page
        page_size
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                "id"                # 价格周期ID
                "name"              # 价格周期名字
                "start_date"        # 开始日期
                "end_date"          # 结束日期
                "creater_id"        # 创建人ID
            },
            ]
        },
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/
    method : GET
    params : {
        page
        page_size
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 3,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 5,
                    "name": "202405",
                    "start_date": "2024-05-01",
                    "end_date": "2024-06-04",
                    "creater_id": 9
                },
                {
                    "id": 6,
                    "name": "202406",
                    "start_date": "2024-06-01",
                    "end_date": "2024-07-01",
                    "creater_id": 9
                }
            ]
        },
        "code": 200
    }
}
```

#### 3. 弃用一个价格周期

使用此方法弃用一个错误的价格周期，弃用后，该价格所关联的本期的价格对象的状态都会被修改为`-99`（已弃用）。已弃用的价格可以在创建新的周期时被复制使用。已弃用的价格无法被任何账户查询到，仅通过数据库直接查看显示。（标记价格弃用而不是删除主要是防止删除价格后，创建周期时没有可用价格的情况）    
执行弃用方法后，该价格周期的`creater_id`会被设置为该账号的id，以标记弃用人。

```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/<id>/deprecate/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/priceCycle/7/deprecate/
    method : POST
    return : {
        "msg": "Price Cycle deprecate",
        "data": null,
        "code": 200
    }
}
```

###  价格请求API 
 不再使用`price_request`表来进行价格请求相关操作，将操作都放在了`price`表中进行。因此`api`都修改为在`api/price/`下进行。   

#### 1. 查看所有价格请求
**权限：仅教体局组(`role=1`)**

显示出目前所有的未审核的价格请求。  
api变更，与粮油公司查看价格一样使用`/api/price/`接口，但教体局组查看`status=1`即待审核的价格，视为价格请求。返回字段与查询价格一样，也可以使用相同的筛选字段   
与价格查询一同修改了状态的表示，现在`status`是中文表示状态名，`status_code`为状态的编码表示   

<font color=red> 修改了教体局的查看权限，可以查看到所有状态的价格（已过期的除外） </font>  

```javascript
{
    url : http://127.0.0.1:8000/api/price/
    method : GET
    params : {
        page
        page_size
        product_id      # 商品ID，筛选出某个商品的所有价格对象
        product_name    # 商品名，筛选出某个商品的所有价格对象
        cycle_id        # 周期ID，筛选出某个周期下的所有价格对象
        category_id     # 种类ID，筛选出某个种类下的所有价格对象
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"                    # 价格对象的ID,修改报价时需使用
                    "price"                 # 当前价格，平均询价下调5%
                    "price_check_1"         # 询价1
                    "price_check_2"         # 询价2
                    "price_check_avg"       # 平均询价
                    "start_date"            # 价格开始日期
                    "end_date"              # 价格结束日期
                    "status"                # 价格状态中文表示
                    "status_code"           # 价格状态编码
                    "creater_id"            # 价格创建者ID
                    "create_time"           # 价格创建时间
                    "reviewer_id"           # 审核人ID
                    "review_time"           # 审核时间
                    "product_id"            # 商品ID
                    "cycle_id"              # 价格周期ID
                    "cycle_name"            # 价格周期名
                    "product_name"          # 商品名称
                    "product_category"      # 商品类别
                    "product_description"   # 商品规格
                }
            ]
        },
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/
    method : GET
    return : {
        "msg": "ok",
        "data": {
            "count": 1,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 29,
                    "price": "28.28",
                    "price_check_1": "28.00",
                    "price_check_2": "30.00",
                    "price_check_avg": "29.00",
                    "start_date": "2024-07-01",
                    "end_date": "2024-08-01",
                    "status_code": "1",
                    "status": "未审核",
                    "creater_id": 3,
                    "create_time": "2024-06-06T11:56:45.501049",
                    "reviewer_id": null,
                    "review_time": null,
                    "product_id": 3,
                    "cycle_id": 9,
                    "cycle_name": "202407",
                    "product_name": "土豆2",
                    "product_category": "蔬菜类",
                    "product_description": "这是土豆2"
                }
            ]
        },
        "code": 200
    }
}
```

#### 2. 批准某个价格请求
**权限：仅教体局组(`role=1`)**

批准某个价格请求,url中传入的是上一点中的**价格的`id`**,不是商品`id`。批准后当前所请求的价格的`status`将会设置为`2`（已审核）。  
 接口url变更   
 接口url变更，使用`api/price/` 

```javascript
{
    url : http://127.0.0.1:8000/api/price/<id>/accept/
    method : POST
    return : {
        "msg"
        "data": null,
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/16/accept/
    method : POST
    return : {
        "msg": "已批准该价格",
        "data": null,
        "code": 200
    }
}
```

#### 3. 拒绝某个价格请求
**权限：仅教体局组(`role=1`)**

拒绝某个价格请求,url中传入**价格的`id`**。拒绝后当前所请求的价格的`status`将会设置为`-1`（已拒绝）。需粮油公司组重新修改价格发起请求。  

 新增   
 接口url变更，使用`api/price/` 

```javascript
{
    url : http://127.0.0.1:8000/api/price/<id>/reject/
    method : POST
    return : {
        "msg"
        "data": null,
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/16/reject/
    method : POST
    return : {
        "msg": "已拒绝该价格",
        "data": null,
        "code": 200
    }
}
```

#### 4. 批量批准价格请求  
 0702新增,通过传入价格对象id列表,批量批准价格请求   
需传入包含价格对象的id的列表

```javascript
{
    url : http://127.0.0.1:8000/api/price/multiaccept/
    method : POST
    data : {
        "price_ids"     # 包含价格对象id的列表
    }
    return : {
        "msg"
        "data"
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/multiaccept/
    method : POST
    data : {
        "price_ids":[892,893,894,895,896,897,898,899,900]
    }
    return : {
        "msg": "价格请求批准成功",
        "data": null,
        "code": 200
    }
}
```

#### 5. 批量拒绝价格请求  
 0702新增,通过传入价格对象id列表,批量拒绝价格请求   
需传入包含价格对象的id的列表

```javascript
{
    url : http://127.0.0.1:8000/api/price/multireject/
    method : POST
    data : {
        "price_ids"     # 包含价格对象id的列表
    }
    return : {
        "msg"
        "data"
        "code"
    }
}
```

示例
```javascript
{
    url : http://127.0.0.1:8000/api/price/multireject/
    method : POST
    data : {
        "price_ids":[892,893,894,895,896,897,898,899,900]
    }
    return : {
        "msg": "价格请求拒绝成功",
        "data": null,
        "code": 200
    }
}

## 订单相关
### 经费来源API

`funds`经费来源数据表:  
```javascript
{
    id          # 经费来源ID
    name        # 经费来源名字
}
```
#### 1. 查看所有的经费来源
**权限：所有登录用户**   
```javascript
{
    url : http://127.0.0.1:8000/api/funds/
    method : GET
    params : {
        page
        page_size
    }
    return :
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/funds/
    method : GET
    return : {
        "msg": "ok",
        "data": {
            "count": 1,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 1,
                    "name": "经费一"
                }
            ]
        },
        "code": 200
    }
}
```

#### 2. 添加经费来源
**权限：教体局组(`role=1`)**

```javascript
{
    url : http://127.0.0.1:8000/api/funds/
    method : POST
    data : {
        "name"          # 经费来源名字
    }
    return :
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/funds/
    method : POST
    data : {
        "name":"经费一"       
    }
    return : {
        "msg": "创建成功",
        "data": {
            "id": 1,
            "name": "经费一"
        },
        "code": 201
    }
}
```
#### 3. 删除经费来源
**权限：教体局组(`role=1`)**  
删除经费来源会导致购物车中的项一并删除
```javascript
{
    url : http://127.0.0.1:8000/api/funds/<id>/     # id为经费来源id
    method : DELETE
    return :
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/funds/5/
    method : DELETE
    return : {
        "msg": "删除成功",
        "data": null,
        "code": 204
    }
}
```

### 购物车相关API
`cart`购物车数据表：
```javascript
{
    id                  # 购物车id
    product             # 外键字段，商品实例，数据库中为product_id，商品ID
    funds               # 外键字段，经费来源实例，数据库中为funds_id，来源ID
    quantity            # 商品数量
    creater_id          # 创建人id
}
```
#### 1. 加入购物车
**权限：仅学校组(`role=2`)**  
加入购物车时，`creater_id`为当前登录用户的`id`，表示创建购物车的学校用户。会检查是否存在此经费来源

```javascript
{
    url : http://127.0.0.1:8000/api/goods/<id>/order/    # id为商品ID
    method : POST
    data : {
        "funds"         # 经费来源ID
        "quantity"      # 购买数量
    }
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/goods/10/order/    # id为商品ID
    method : POST
    data : {
        "funds": 1
        "quantity": 10
    }
    return : {
        "msg": "成功添加至购物车",
        "data": null,
        "code": 200
    }
}
```
#### 2. 查看购物车
**权限：仅学校组(`role=2`)**  
仅能查看自己账户所创建的购物车。查看购物车时会根据当期价格，返回各个商品的总价。当购物车内的商品没有当期价格时，系统会对购物车项进行删除。  
<font color=red> 修改了返回字段，添加了商品品牌;购物车不显示资质图片 </font>

```javascript
{
    url : http://127.0.0.1:8000/api/cart/
    method : GET
    params : {
        page
        page_size
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"                # 购物车项ID
                    "quantity"          # 购买数量
                    "funds"             # 经费来源
                    "brand"             # 商品品牌
                    "product_name"      # 商品名
                    "product_id"        # 商品ID
                    "description"       # 商品规格
                    "category"          # 商品类别
                    "image"             # 商品图片
                    "price"             # 商品当期价格
                    "tolto_price"       # 商品总价
                }
            ]
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/cart/
    method : GET
    params : {
        page
        page_size
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 1,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 8,
                    "quantity": "17.00",
                    "funds": "经费一",
                    "product_name": "鸡肉",
                    "brand": "鸡肉",
                    "product_id": 10,
                    "description": "这是鸡肉",
                    "category": "肉类",
                    "image": null,
                    "price": 35.35,
                    "tolto_price": 600.95
                }
            ]
        },
        "code": 200
    }
}
```
#### 3. 购物车修改
**权限：仅学校组(`role=2`)**  
仅能修改自己账户所创建的购物车。可以修改购物车中商品的数量和经费来源。  
```javascript
{
    url : http://127.0.0.1:8000/api/cart/<id>/      # id为购物车id
    method : PATCH
    data : {
        "quantity"          # 购买数量
        "funds"             # 经费来源ID
    }
    return : {
        "msg"
        "data": {
            "quantity"              # 修改后的数量
            "funds"                 # 修改后的经费来源
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/cart/10/      # id为购物车id
    method : PATCH
    data : {
        "quantity" : 11          # 购买数量
        "funds" : 1              # 经费来源ID
    }
    return : {
        "msg": "更新成功",
        "data": {
            "quantity": "11.00"
            "funds": "经费一"
        },
        "code": 200
    }
}
```
#### 4. 购物车删除商品
**权限：仅学校组(`role=2`)**  
仅能删除自己账户所创建的购物车。  
```javascript
{
    url : http://127.0.0.1:8000/api/cart/<id>/      # id为购物车id
    method : DELETE
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/cart/10/     
    method : DELETE
    return : {
        "msg": "删除成功",
        "data": null,
        "code": 204
    }
}
```
#### 5. 购物车下单
**权限：仅学校组(`role=2`)**  
仅能下单自己账户所创建的购物车。传入包含`购物车id`的列表（可部分下单），后台会创建一个订单对象，订单的`status`设为`0`（未接单），`creater_id`会被设置为操作下单的用户`id`，`create_time`将被设置为下单时的时间。同时，依据所选商品的数量、价格等为每一个商品创建一个订单详情对象，每个订单详情对象都会关联到一个订单上，表示是某个订单下的具体商品情况。下单后的商品将在购物车表中删除。  
<font color=red> 下单时增加了送货日期字段`deliver_date`，当已下订单还处于待接单状态时`status=0`，同一个`deliver_date`下新的订单将会与旧订单进行合并。 </font>

```javascript
{
    url : http://127.0.0.1:8000/api/cart/purchase/
    method : POST
    data : {
        "cart_ids"          # 购物车商品项的id的列表
        "deliver_date"      # 送货日期
    }
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/cart/purchase/
    method : POST
    data : {
        "cart_ids" : [1,2,3],
        "deliver_date" : "2024-08-23"
    }
    return : {
        "msg": "商品下单成功",
        "data": null,
        "code": 200
    }
}
```
### 订单相关API
`order`订单数据表：  
<font color=red> 订单表`order`新增`deliver_date`字段，表示送货日期; 订单状态`status`种类增加 </font>  
<font color=red> 订单详情表`order_detail`新增`brand`字段，表示商品品牌 </font>

```javascript
{
    id                  # 订单ID
    status              # 配送状态（0：未接单，1：未发货，2：配送中，3：配送完成，4：已收货待复核, 5: 订单有疑问, 6:订单完成, -1:撤销）
    creater_id          # 订单创建人ID
    create_time         # 订单下单时间
    accepter_id         # 订单接受人ID
    accept_time         # 订单接受时间
    finish_time         # 订单完成时间（当所有商品都收货后）
    finish_num          # 完成商品类目数目
    product_num         # 下单商品类目总数
    deliver_date        # 送货日期
}
```
`order_detail`订单详情数据表：
```javascript
{
    id                  # 订单详情ID
    order               # 外键字段，订单实例，数据库中为order_id，订单ID
    product_id          # 商品ID
    product_name        # 商品名
    description         # 商品规格
    category            # 商品种类
    price               # 下单时价格
    funds               # 资金来源（funds对象的name）
    order_quantity      # 下单数量
    received_quantity   # 收货数量
    cost                # 实付总价（收货量*单价）
    recipient_id        # 订单收货人ID 
    recipient_time      # 订单收货时间
    brand               # 商品品牌
}
```

#### 1. 查看订单
**权限：已登录用户**  
学校方`(role=2)`可以查询以自己为创建人的所有订单，粮油公司`(role=0)`和教体局`(role=1)`可以查询到所有的订单。可以使用`status`筛选不同状态的订单，使用`creater_id`筛选不同学校的订单。

<font color=red> 增加了`deliver_date`字段的筛选和返回 </font>

```javascript
{
    url : http://127.0.0.1:8000/api/orders/
    method ： GET
    params : {
        page
        page_size
        status                  # 订单状态编码
        creater_id              # 创建人ID
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"                    # 订单号
                    "status"                # 订单状态（状态名）
                    "status_code"           # 状态代号
                    "creater_id"            # 下单人ID
                    "create_time"           # 下单时间
                    "accepter_id"           # 接单人ID
                    "accept_time"           # 接单时间
                    "product_num"           # 商品项数目
                    "finish_num"            # 完成项数目
                    "finish_time"           # 完成时间
                    "deliver_date"          # 送货日期
                }
            ]
        },
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/
    method ： GET
    params : {
        page
        page_size
        status                  # 订单状态
        creater_id              # 创建人ID
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 1,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 1,
                    "status": "待发货",
                    "status_code": "0",
                    "creater_id": 4,
                    "create_time": "2024-06-14T11:10:52.836133",
                    "accepter_id": null,
                    "accept_time": null,
                    "product_num": 5,
                    "finish_num": 0,
                    "finish_time": null,
                    "deliver_date": "2024-08-23"
                }
            ]
        },
        "code": 200
    }
}
```
#### 2. 查看订单详情
**权限：已登录用户**  
学校方`(role=2)`可以查询以自己为创建人的订单的详情，粮油公司`(role=0)`和教体局`(role=1)`可以查询到所有的。用此api查询某个订单下所关联的所有商品信息。

<font color=red> 返回增加了`brand`品牌 </font>

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/details/  #id为订单ID
    method ： GET
    params : {
        page
        page_size
    }
    return : {
        "msg"
        "data": {
            "count"
            "next"
            "previous"
            "results": [
                {
                    "id"                    # 详情表内id
                    "product_id"            # 商品id
                    "product_name"          # 商品名
                    "brand"                 # 商品品牌
                    "description"           # 商品规格
                    "category"              # 商品种类
                    "price"                 # 购入价格
                    "funds"                 # 经费来源
                    "order_quantity"        # 订购数量
                    "received_quantity"     # 实收数量
                    "cost"                  # 实际金额
                    "recipient_id"          # 收货人id
                    "recipient_time"        # 收货时间
                    "order"                 # 订单号
                }
            ]
        },
        "code"
    }
} 
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/details/  #id为订单ID
    method ： GET
    params : {
        page
        page_size
    }
    return : {
        "msg": "ok",
        "data": {
            "count": 2,
            "next": null,
            "previous": null,
            "results": [
                {
                    "id": 1,
                    "product_id": 10,
                    "product_name": "鸡肉",
                    "description": "这是鸡肉",
                    "brand": "鸡肉",
                    "category": "肉类",
                    "price": "35.35",
                    "funds": "经费一",
                    "order_quantity": "15.00",
                    "received_quantity": null,
                    "cost": null,
                    "recipient_id": null,
                    "recipient_time": null,
                    "order": 2
                }
            ]
        },
        "code": 200
    }
} 
```
#### 3. 接受订单
**权限：仅粮油公司组(`role=0`)**  
仅能对已下单未接受状态`status=0`的订单进行接单操作，接单后将添加接单时间`accept_time`，接单人`accepter_id`，并将订单对象的`status`设为`1`（待发货）。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/accept/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/accept/
    method : POST
    return : {
        "msg": "接单成功",
        "data": null,
        "code": 200
    }
}
```

#### 4. 订单发货
**权限：仅粮油公司组(`role=0`)**  
仅能对未发货状态`status=1`的订单进行发货操作，发货后将订单对象的`status`设为`2`（配送中）。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/ship/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/ship/
    method : POST
    return : {
        "msg": "发货成功",
        "data": null,
        "code": 200
    }
}
```
#### 5. 订单送达
**权限：仅粮油公司组(`role=0`)**  
仅能对配送中状态`status=2`的订单进行送达操作，送达后将订单对象的`status`设为`3`（配送完成）。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/delivered/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/delivered/
    method : POST
    return : {
        "msg": "订单送达成功",
        "data": null,
        "code": 200
    }
}
```

#### 6. 订单确认收货
**权限：仅学校组(`role=2`)**  
<font color=red> 重写了接口 </font>  
接口接收以列表方式存储的json对象，传入订单详情`id`和实收数量`received_quantity`。需先用2中的接口查询到订单详情（主要是需要`id`）。当所有商品核实完成后，该订单算作确认收货，会修改`order`表中的`finish_num`，当`finish_num`等于`product_num`时会将订单状态修改为`4`（已收货待复核）。  
会将当前用户`id`作为`recipient_id`，当前时间作为`recipient_time`。用户需传入实收数量`received_quantity`，商品的总价`cost`将根据`received_quantity`和`price`进行计算。  
当复核有问题后，依然可以用该接口重新进行确认收货操作。该接口仅在订单状态`status`为`3配送完成`,`4已收货待复核`,`5订单有疑问`时有效。此时会将订单状态重新设为`4`（已收货待复核）。
<font color=red> 注：现在`url`中填写的`id`为订单`order`的`id`,而非订单详情`id`。 </font>  

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/confirm/   # id为订单表中的id
    method : POST
    data : {
        "recv":[
            {
                "id"                    # 订单详情id
                "received_quantity"     # 实收数量
            }
        ]
    }
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/confirm/
    method : POST
    data : {
        "recv": [
            {
                "id": 1,
                "received_quantity": 10
            },
            {
                "id": 2,
                "received_quantity": 5
            }
        ]
    }
    return : {
        "msg": "商品收货成功",
        "data": null,
        "code": 200
    }
}
```

#### 7. 订单复核有问题
**权限：仅粮油公司组(`role=0`)**  
<font color=red> 新增 </font>  
仅能对已收货待复核状态`status=4`的订单进行操作，会将订单对象的`status`设为`5（订单有疑问）`。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/argue/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/argue/
    method : POST
    return : {
        "msg": "订单复核结果：订单有疑问",
        "data": null,
        "code": 200
    }
}
```

#### 8. 订单复核成功
**权限：仅粮油公司组(`role=0`)**  
<font color=red> 新增 </font>  
仅能对已收货待复核状态`status=4`和订单有疑问状态`status=5`的订单进行操作，会将订单对象的`status`设为`6（订单完成）`。并添加订单完成时间`finish_time`。


```javascript
{
    url : http://127.0.0.1:8000/api/orders/<id>/agree/
    method : POST
    return : {
        "msg"
        "data"
        "code"
    }
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/1/agree/
    method : POST
    return : {
        "msg": "订单复核结果：订单完成",
        "data": null,
        "code": 200
    }
}
```

#### 9. 订单报表下载
**权限：登录账户均可**  
教体局`(role=1)`和粮油公司`(role=0)`组可以查看到任一学校的订单情况并下载报表，下载时填写起止时间和学校账户`ID`进行下载，可以获得对应时间段内某学校的所有订单详情。学校账户`(role=2)`仅能查看和下载自己账户的订单报表，只需要填写起止时间。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/report/
    method : POST
    data : {
        "start_date"            # 开始时间
        "end_date"              # 停止时间
        "school_id"             # 学校账户ID（仅教体局和粮油公司组可用）
    }
    return : excel文件
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/report/
    method : POST
    data : {
        "start_date" : "2024-06-01"
        "end_date" : "2024-07-01"
        "school_id" : "5"
    }
    return : "泸定中学_2024-06-01~2024-07-01_订单报表.xlsx"
}
```

#### 10. 配送表下载
**权限：仅粮油公司组(`role=0`)**  
<font color=red> 新增 </font>  
传入学校账户`ID`和送货日期`deliver_date`，下载对应学校在该日期下的配送表。不能再对已完成订单`status=6`进行配送表下载。


```javascript
{
    url : http://127.0.0.1:8000/api/orders/gendeliver/
    method : POST
    data : {
        "deliver_date"          # 送货日期
        "school_id"             # 学校账户ID（仅教体局和粮油公司组可用）
    }
    return : excel文件
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/gendeliver/
    method : POST
    data : {
        "deliver_date" : "2024-08-23"
        "school_id" : "4"
    }
    return : "泸定中学_2024-08-23_送货单.xlsx"
}
```

#### 11. 经费报表下载
**权限：仅教体局组`(role=1)`**  
<font color=red> 新增 </font>  
填写起止时间`start_date`,`end_date`和学校账户`ID`进行下载，可以获得对应时间段内某学校的经费使用情况。

```javascript
{
    url : http://127.0.0.1:8000/api/orders/genfunds/
    method : POST
    data : {
        "start_date"            # 开始时间
        "end_date"              # 停止时间
        "school_id"             # 学校账户ID（仅教体局和粮油公司组可用）
    }
    return : docx文件
}
```
示例
```javascript
{
    url : http://127.0.0.1:8000/api/orders/genfunds/
    method : POST
    data : {
        "start_date" : "2024-06-01"
        "end_date" : "2024-07-01"
        "school_id" : "5"
    }
    return : "2024-08-01~2024-08-31_泸定中学经费使用情况"
}
```