# 采购系统接口文档
## 账户相关
### 人员权限
**管理员：**

用户名:admin

密码:admin8888

权限：增加、删除账户，重置账户密码

**粮食公司：**

用户`role`属性表示为`0`

权限:
- 物品的查看、添加、删除、修改
- 价格的添加、查询
- 计量单位的添加、查询、修改

**教体局：**

用户`role`属性表示为`1`

权限：
- 物品的查看

**学校：**

用户`role`属性表示为`2`

权限：
- 物品的查看

### 相关API
#### 1. 添加人员（仅限管理员）
用于添加访问账户，可选用户所属角色组，关系到访问权限。新添加的用户的密码都是`123456`，并在登录时以`is_simple`标记用户是否修改了默认密码。
```
{
    url : "127.0.0.1:7999/api/accounts"
    method : POST
    data : {
        "username"  # 用户名
        "role"      # 角色(粮油公司0, 教体局1, 学校2)
    }
    return : {
        "id"
        "username"
        "is_active"
        "role"
    }
}
```
示例：
```
{
    url : "http://127.0.0.1:7999/api/accounts/"
    method : POST
    data : {
        "username" : "ldzx",
        "role" : 2
    }
    return : {
        "id": 4,
        "username": "ldzx",
        "is_active": true,
        "role": 2
    }   
}
```
#### 2. 修改密码（用户）
用于用户修改自己的密码，仅能修改自己的密码
```
{
    url : http://127.0.0.1:8000/api/accounts/<id>/
    method : PUT
    data: {
        "username" # id对应的用户名
        "password" # 修改后的密码
    }
    return : {
        "id"
        "username"
        "is_active"
        "role"
    }
}
```
示例
```
{
    url : http://127.0.0.1:8000/api/accounts/4/
    method : PUT
    data : {
        "username":"ldzx",
        "password":"654321"
    }
    return : {
        "id": 4,
        "username": "ldzx",
        "is_active": true,
        "role": 2
    }  
}
```
#### 3. 重置密码（管理员）
用于用户遗忘密码无法登录时，管理员进行强制密码重置，用户密码将会重置为`123456`。
```
{
    url : http://127.0.0.1:8000/api/accounts/<id>/
    method : PATCH
    data : {
        "username" # id对应的用户名
    }
    return : {
        "id"
        "username"
        "is_active"
        "role"
    }
}
```
示例：
```
{
    url : http://127.0.0.1:8000/api/accounts/4/
    method : PATCH
    data : {
        "username":"ldzx",
    }
    return : {
        "id": 4,
        "username": "ldzx",
        "is_active": true,
        "role": 2
    }  
}
```
#### 4. 用户登录
用于用户登录获得`token`，系统会返回`token`、`username`、`role`等，可用于前端分权限显示界面。绝大部分后端API都需要传入`token`。
```
{
    url : http://127.0.0.1:7999/api/login/
    method : POST
    data : {
        "username" # 用户名
        "password" # 密码
    }
    return : {
        "refresh"   # 用于刷新token，暂时没用
        "access"    # token，用于权限管理
        "id"        # 用户ID,有很多地方需要传入id
        "username"  # 用户名
        "role"      # 角色组，进行分组权限管理
        "is_simple" # 标记密码是否为默认密码，如果为    true，应指引用户进行修改
        "is_admin"  # 标记是否为管理员
    }
}
```
示例:
```
{
    url : http://127.0.0.1:7999/api/login/
    method : POST
    data : {
        "username" : "ldzx",
        "password" : "123456"
    }
    return : {
        "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTcxNjU0NDY1MSwiaWF0IjoxNzE1OTM5ODUxLCJqdGkiOiI0N2RmZmM4MzQzM2Y0NTkxYjc4MjNlZGU4NTBjNmY5MCIsInVzZXJfaWQiOjR9.xbggOkQF4XXHPLNrLmS93er0ClN3m7jtzHhywFM1w_s",
        "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzE2NTQ0NjUxLCJpYXQiOjE3MTU5Mzk4NTEsImp0aSI6ImZiNDBiM2EwMmUzNzRhOTRiOWM2OWQxMjRlOGY5ODE0IiwidXNlcl9pZCI6NH0.tOo1DuT-HD9nHLr9xyQHzPg8cO94Z9lkiZD6NRuUpvU",
        "id": 4,
        "username": "ldzx",
        "role": "2",
        "is_simple": true,
        "is_admin": false
    }
}
```
## 商品相关
### 相关API
#### 1. 查看所有商品
**权限：所有登录的用户**

用于查看所有已上架的商品
```
{
    url : http://127.0.0.1:8000/api/goods
    method : GET
    params : {
        page        # 页数
        page_size   # 每页的个数
    }
    return : {
        "count": 1,              # 查询到的总个数
        "next": null,            # 下一页
        "previous": null,        # 上一页
        "results": [
            {
                "id"             # 商品ID
                "name"           # 商品名称
                "image"          # 商品图片
                "description"    # 商品描述
                "price"          # 商品价格
                "start_time"     # 价格开始时间
                "end_time"       # 价格结束时间
                "unit"           # 商品的计量单位
            }
        ]
    }
}
```
 示例
 ```
 {
    url : http://127.0.0.1:8000/api/goods
    method : GET
    params : {
        page        # 页数
        page_size   # 每页的个数
    }
    return : {
        "count": 1,
        "next": null,
        "previous": null,
        "results": [
            {
                "id": 2,
                "name": "土豆",
                "image": "http://127.0.0.1:8000/media/goods/57ee331ceda10c33141b029db79ebd39_BDaNlVJ.jpg",
                "description": "这是土豆",
                "price": 9.32,
                "start_time": "2024-05-11T20:43:08.943100",
                "end_time": "2024-06-11T20:43:08.943100",
                "unit": "千克"
            }
        ]
    }
}
 ```
#### 2. 添加商品
**权限：仅粮油公司组(`role=2`)**
添加商品，添加时会将当前的价格的有效期设置为从当前时间到一个月之后。
```
{
    url : http://127.0.0.1:8000/api/goods
    method : POST
    data : {
        "name"          # 商品名称
        "image"         # 商品图片
        "description"   # 商品描述
        "price"         # 商品价格
        "unit"          # 商品计量单位（注意需要先在数据库中添加计量单位，然后传入对应单位的id）
    }
    return : {
        "id"
        "name"
        "image"         # 服务器上图片的地址
        "description"
        "price"
        "start_time"    # 价格开始时间
        "end_time"      # 价格结束时间
        "unit"
    }
}
```
示例
```
{
    url : http://127.0.0.1:8000/api/goods
    method : POST
    data : {
        "name": "土豆2"
        "image": 图片文件
        "description": "这是土豆2"
        "price": 9.68
        "unit": 2
    }
    return : {
        "id": 3,
        "name": "土豆2",
        "image": "http://127.0.0.1:8000/media/goods/57ee331ceda10c33141b029db79ebd39_cSPNqnX.jpg",
        "description": "这是土豆2",
        "price": 9.68,
        "start_time": "2024-05-17T18:23:27.632220",
        "end_time": "2024-06-16T18:23:27.632220",
        "unit": "克"
    }
}
```
